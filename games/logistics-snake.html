<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FBA è¡¥è´§æƒŠé­‚ - The Logistics Chain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #232F3E; /* Amazon Dark Blue */
            color: white;
            overflow: hidden; /* Prevent scrolling */
            touch-action: none; /* Prevent default touch actions */
        }

        #game-board {
            background-color: #f3f3f3;
            border: 4px solid #FF9900; /* Amazon Orange */
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            image-rendering: pixelated;
        }

        .btn-control {
            background-color: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.1s;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        .btn-control:active {
            background-color: #FF9900;
            border-color: #FF9900;
            transform: scale(0.9);
        }

        /* ç§»åŠ¨ç«¯æ§åˆ¶åŒºåŸŸæ ·å¼ */
        .mobile-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 20px 30px 20px;
            width: 100%;
            max-width: 280px;
        }

        .control-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            width: 100%;
        }

        @media (min-width: 768px) {
            .mobile-controls {
                display: none;
            }
        }

        /* Modal Overlay */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            backdrop-filter: blur(5px);
        }

        .hidden { display: none !important; }

        .score-box {
            background: #37475A;
            padding: 8px 16px;
            border-radius: 8px;
            border-left: 4px solid #FF9900;
        }
        
        /* é—ªçƒçš„æç¤ºæ–‡å­— */
        .blink-text {
            animation: blinker 1.5s linear infinite;
        }
        @keyframes blinker {
            50% { opacity: 0; }
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-between py-4">

    <!-- Header / Score -->
    <div class="w-full max-w-md px-4 flex justify-between items-center z-10">
        <div>
            <h1 class="font-bold text-xl italic"><i class="fas fa-shipping-fast text-orange-500 mr-2"></i>FBA è¡¥è´§æƒŠé­‚</h1>
            <p class="text-xs text-gray-400">Logistics Snake v1.2</p>
        </div>
        <div class="score-box text-right">
            <div class="text-xs text-gray-400">FBA åº“å­˜ (ä»¶)</div>
            <div class="text-2xl font-bold font-mono text-orange-400" id="score">0</div>
        </div>
    </div>

    <!-- Game Canvas Container -->
    <div class="relative flex-1 flex items-center justify-center w-full p-4">
        <canvas id="game-board" width="400" height="400" class="max-w-full max-h-full rounded-lg"></canvas>
        <!-- ç­‰å¾…å¼€å§‹çš„æç¤ºå±‚ -->
        <div id="start-hint" class="absolute pointer-events-none hidden">
            <p class="text-gray-500 font-bold bg-white/80 px-4 py-2 rounded-full shadow-lg blink-text">
                <i class="fas fa-arrow-up"></i> æŒ‰æ–¹å‘é”®å‘è´§
            </p>
        </div>
    </div>

    <!-- Mobile Controls (D-Pad) -->
    <div class="mobile-controls">
        <div class="control-row">
            <button class="btn-control" id="btn-up"><i class="fas fa-chevron-up"></i></button>
        </div>
        <div class="control-row">
            <button class="btn-control" id="btn-left"><i class="fas fa-chevron-left"></i></button>
            <button class="btn-control bg-orange-600 border-orange-500" onclick="togglePause()"><i class="fas fa-pause text-sm"></i></button>
            <button class="btn-control" id="btn-right"><i class="fas fa-chevron-right"></i></button>
        </div>
        <div class="control-row">
            <button class="btn-control" id="btn-down"><i class="fas fa-chevron-down"></i></button>
        </div>
    </div>

    <!-- Desktop Hint -->
    <div class="hidden md:block text-gray-400 text-sm pb-4">
        ä½¿ç”¨é”®ç›˜æ–¹å‘é”® <i class="fas fa-arrows-alt"></i> æ§åˆ¶è´§è½¦ç§»åŠ¨
    </div>

    <!-- Start/Game Over Screen -->
    <div id="start-screen" class="modal">
        <i class="fas fa-truck-loading text-6xl text-orange-500 mb-4 animate-bounce"></i>
        <h2 class="text-3xl font-bold mb-2">å‡†å¤‡å‘è´§ï¼Ÿ</h2>
        <p class="text-gray-400 mb-6 text-center px-6">åƒæ‰ç®±å­å¢åŠ åº“å­˜<br>ä¸è¦æ’å¢™(æµ·å…³)æˆ–æ’è‡ªå·±(èµ„é‡‘é“¾)</p>
        
        <div class="mb-6 w-64">
            <label class="text-xs text-gray-400 uppercase tracking-widest block mb-2">ä½ çš„ä»£å· (ID)</label>
            <input type="text" id="user-id" placeholder="è¾“å…¥ä½ çš„ID..." maxlength="20"
                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white text-center focus:outline-none focus:border-orange-500 transition">
        </div>
        
        <button onclick="startGame()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105 active:scale-95 text-xl">
            å¼€å§‹è¡¥è´§ (Start)
        </button>
        
        <button onclick="showLeaderboard()" class="mt-4 text-gray-400 hover:text-orange-400 transition">
            <i class="fas fa-trophy mr-2"></i>æŸ¥çœ‹æ’è¡Œæ¦œ
        </button>
    </div>

    <div id="game-over-screen" class="modal hidden">
        <div id="death-icon" class="text-6xl text-red-500 mb-4">
            <i class="fas fa-file-invoice-dollar"></i>
        </div>
        <h2 class="text-3xl font-bold mb-2 text-red-500" id="death-title">èµ„é‡‘é“¾æ–­è£‚!</h2>
        <p class="text-gray-300 mb-6 text-center px-6" id="death-reason">ä½ æ’åˆ°äº†è‡ªå·±ï¼Œå¯¼è‡´ç°é‡‘æµå´©æºƒã€‚</p>
        
        <div class="bg-gray-800 p-4 rounded-lg mb-6 text-center border border-gray-600 w-64">
            <p class="text-xs text-gray-400 uppercase tracking-widest">æœ€ç»ˆåº“å­˜</p>
            <p class="text-4xl font-bold text-white mt-1" id="final-score">0</p>
        </div>

        <div id="submitting-score" class="hidden mb-4">
            <i class="fas fa-spinner fa-spin text-orange-500"></i>
            <span class="text-gray-400 ml-2">æ­£åœ¨æäº¤åˆ†æ•°...</span>
        </div>

        <div class="flex flex-col gap-3">
            <button onclick="startGame()" class="bg-white text-gray-900 hover:bg-gray-200 font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105 active:scale-95">
                é‡æ–°å‘è´§ (Restart)
            </button>
            <button onclick="showLeaderboard()" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition">
                <i class="fas fa-trophy mr-2"></i>æŸ¥çœ‹æ’è¡Œæ¦œ
            </button>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboard-screen" class="modal hidden">
        <div class="text-6xl text-orange-500 mb-4">
            <i class="fas fa-trophy"></i>
        </div>
        <h2 class="text-3xl font-bold mb-6">FBA è¡¥è´§æ’è¡Œæ¦œ</h2>
        
        <div id="leaderboard-loading" class="text-gray-400 mb-6">
            <i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...
        </div>
        
        <div id="leaderboard-list" class="bg-gray-800 rounded-lg border border-gray-600 w-80 max-h-80 overflow-y-auto mb-6 hidden">
        </div>
        
        <button onclick="hideLeaderboard()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105 active:scale-95">
            è¿”å›
        </button>
    </div>

    <script>
        // --- æ¸¸æˆé…ç½® ---
        const canvas = document.getElementById('game-board');
        const ctx = canvas.getContext('2d');
        
        const dpr = window.devicePixelRatio || 1;
        const tileCount = 20; 
        let tileSize = 20;

        let speed = 7;
        let score = 0;
        
        let headX = 10;
        let headY = 10;
        let xVelocity = 0;
        let yVelocity = 0;

        let appleX = 5;
        let appleY = 5;

        const snakeParts = [];
        let tailLength = 2;

        // æ ¸å¿ƒä¼˜åŒ–ï¼šè¾“å…¥ç¼“å†²é˜Ÿåˆ—
        let inputQueue = [];

        let gameInterval;
        let isRunning = false;
        let isPaused = false;

        // --- åˆå§‹åŒ– & å“åº”å¼å¸ƒå±€ ---
        function resizeGame() {
            const maxWidth = Math.min(window.innerWidth - 32, 600);
            const maxHeight = window.innerHeight - 250;
            const size = Math.min(maxWidth, maxHeight);
            
            canvas.style.width = size + "px";
            canvas.style.height = size + "px";
            
            canvas.width = size * dpr;
            canvas.height = size * dpr;
            ctx.scale(dpr, dpr);
            
            tileSize = size / tileCount;
            
            if (!isRunning && !isPaused) {
                drawGame();
            }
        }

        window.addEventListener('resize', resizeGame);
        resizeGame();

        // --- æ¸¸æˆå¾ªç¯ ---
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            
            // é‡ç½®çŠ¶æ€
            headX = 10; headY = 10;
            snakeParts.length = 0;
            tailLength = 2;
            score = 0;
            xVelocity = 0; yVelocity = 0;
            inputQueue = []; // æ¸…ç©ºè¾“å…¥é˜Ÿåˆ—
            speed = 5; 
            
            updateScore();
            placeApple();
            
            isRunning = true;
            isPaused = false;
            
            document.getElementById('start-hint').classList.remove('hidden');

            if (gameInterval) clearTimeout(gameInterval);
            drawGame();
        }

        function drawGame() {
            if (!isRunning) return;

            // 1. å¤„ç†è¾“å…¥é˜Ÿåˆ— (æ ¸å¿ƒä¿®å¤)
            // æ¯ä¸€å¸§å¦‚æœé˜Ÿåˆ—é‡Œæœ‰æŒ‡ä»¤ï¼Œå°±æ‹¿å‡ºä¸€ä¸ªæ¥æ‰§è¡Œ
            if (inputQueue.length > 0) {
                let nextMove = inputQueue.shift();
                xVelocity = nextMove.x;
                yVelocity = nextMove.y;
            }

            let currentSpeed = 5 + Math.floor(score / 5);
            if (currentSpeed > 15) currentSpeed = 15;

            const isMoving = xVelocity !== 0 || yVelocity !== 0;

            if (isMoving) {
                 document.getElementById('start-hint').classList.add('hidden');
            }

            if (!isPaused && isMoving) {
                changeSnakePosition();
                let result = checkGameOver();
                if (result) return;
            }

            clearScreen();
            checkAppleCollision();
            drawApple();
            drawSnake(isMoving);
            
            if (!isPaused) {
                gameInterval = setTimeout(drawGame, 1000 / currentSpeed);
            }
        }

        function clearScreen() {
            ctx.fillStyle = '#f3f3f3';
            ctx.fillRect(0, 0, canvas.width / dpr, canvas.height / dpr);
            
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * tileSize, 0);
                ctx.lineTo(i * tileSize, canvas.height / dpr);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * tileSize);
                ctx.lineTo(canvas.width / dpr, i * tileSize);
                ctx.stroke();
            }
        }

        function drawSnake(isMoving) {
            ctx.fillStyle = '#FF9900';
            ctx.font = `${tileSize * 0.9}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            for (let i = 0; i < snakeParts.length; i++) {
                let part = snakeParts[i];
                ctx.fillText('ğŸ“¦', part.x * tileSize + tileSize/2, part.y * tileSize + tileSize/2 + 2);
            }

            if (isMoving) {
                snakeParts.push(new SnakePart(headX, headY));
                while (snakeParts.length > tailLength) {
                    snakeParts.shift();
                }
            }

            ctx.fillStyle = '#232F3E';
            ctx.save();
            let textX = headX * tileSize + tileSize/2;
            let textY = headY * tileSize + tileSize/2 + 2;
            
            if (xVelocity === -1) {
                ctx.scale(-1, 1);
                textX = -textX;
            }
            
            ctx.fillText('ğŸšš', textX, textY);
            ctx.restore();
        }

        function drawApple() {
            ctx.font = `${tileSize}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            let bounce = Math.sin(Date.now() / 200) * 2;
            ctx.fillText('ğŸ“¦', appleX * tileSize + tileSize/2, appleY * tileSize + tileSize/2 + bounce);
            
            ctx.strokeStyle = 'rgba(255, 153, 0, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(appleX * tileSize + tileSize/2, appleY * tileSize + tileSize/2, tileSize/2 - 2, 0, Math.PI*2);
            ctx.stroke();
        }

        function checkAppleCollision() {
            if (appleX === headX && appleY === headY) {
                score++;
                tailLength++;
                updateScore();
                placeApple();
            }
        }

        function changeSnakePosition() {
            headX = headX + xVelocity;
            headY = headY + yVelocity;
        }

        function placeApple() {
            let valid = false;
            while (!valid) {
                appleX = Math.floor(Math.random() * tileCount);
                appleY = Math.floor(Math.random() * tileCount);
                
                valid = true;
                if (appleX === headX && appleY === headY) valid = false;
                for (let part of snakeParts) {
                    if (part.x === appleX && part.y === appleY) {
                        valid = false;
                        break;
                    }
                }
            }
        }

        function checkGameOver() {
            let gameOver = false;
            let title = "";
            let reason = "";
            let iconClass = "";

            if (headX < 0 || headX === tileCount || headY < 0 || headY === tileCount) {
                gameOver = true;
                title = "è´§ç‰©è¢«æ‰£æŠ¼!";
                reason = "ä½ çš„è´§è½¦æ’ä¸Šäº†æµ·å…³æŸ¥éªŒçº¢çº¿ (è¾¹å¢ƒå¢™)ã€‚";
                iconClass = "fa-ban";
            }

            for (let i = 0; i < snakeParts.length; i++) {
                let part = snakeParts[i];
                if (part.x === headX && part.y === headY) {
                    gameOver = true;
                    title = "èµ„é‡‘é“¾æ–­è£‚!";
                    reason = "è¿‡åº¦æ‰©å¼ å¯¼è‡´ç°é‡‘æµå´©æºƒ (æ’åˆ°äº†è‡ªå·±çš„å°¾å·´)ã€‚";
                    iconClass = "fa-file-invoice-dollar";
                    break;
                }
            }

            if (gameOver) {
                isRunning = false;
                document.getElementById('final-score').innerText = score;
                document.getElementById('death-title').innerText = title;
                document.getElementById('death-reason').innerText = reason;
                document.getElementById('death-icon').innerHTML = `<i class="fas ${iconClass}"></i>`;
                
                document.getElementById('game-over-screen').classList.remove('hidden');
                document.getElementById('start-hint').classList.add('hidden');
                
                submitScore();
            }
            return gameOver;
        }

        function updateScore() {
            document.getElementById('score').innerText = score;
        }

        function SnakePart(x, y) {
            this.x = x;
            this.y = y;
        }

        // --- æ§åˆ¶é€»è¾‘ (æ ¸å¿ƒä¿®å¤) ---

        // æ–°å¢ï¼šè¾“å…¥é˜Ÿåˆ—å¤„ç†å‡½æ•°
        function queueMove(nx, ny) {
            // æˆ‘ä»¬éœ€è¦å¯¹æ¯”çš„æ˜¯â€œä¸Šä¸€ä¸ªè®¡åˆ’ä¸­çš„ç§»åŠ¨â€ï¼Œè€Œä¸æ˜¯â€œå½“å‰å®é™…ç§»åŠ¨â€
            // è¿™æ ·å¦‚æœä½ å¿«é€Ÿè¾“å…¥ [ä¸Š, å·¦]ï¼Œç¬¬äºŒä¸ª"å·¦"ä¼šå¯¹æ¯”"ä¸Š"ï¼Œè€Œä¸æ˜¯å¯¹æ¯”å½“å‰çš„"å³"
            let lastMove = inputQueue.length > 0 ? inputQueue[inputQueue.length - 1] : { x: xVelocity, y: yVelocity };
            
            // å¦‚æœæ˜¯é™æ­¢çŠ¶æ€ï¼ˆæ¸¸æˆåˆšå¼€å§‹ï¼‰ï¼Œå…è®¸ä»»ä½•æ–¹å‘
            if (lastMove.x === 0 && lastMove.y === 0) {
                 inputQueue.push({ x: nx, y: ny });
                 return;
            }

            // 1. ç¦æ­¢æ‰å¤´ (ä¸èƒ½ç›´æ¥åå‘)
            if (nx !== 0 && lastMove.x === -nx) return;
            if (ny !== 0 && lastMove.y === -ny) return;
            
            // 2. ç¦æ­¢é‡å¤åŒæ–¹å‘ (å¯é€‰ï¼Œä¸ºäº†é˜Ÿåˆ—å¹²å‡€)
            if (nx === lastMove.x && ny === lastMove.y) return;

            // 3. é™åˆ¶é˜Ÿåˆ—é•¿åº¦ (é˜²æ­¢æŒ‰å¤ªå¿« buffer äº†æœªæ¥çš„åæ­¥æ“ä½œï¼Œæ„Ÿè§‰åƒå»¶è¿Ÿ)
            if (inputQueue.length >= 2) return;

            inputQueue.push({ x: nx, y: ny });
        }
        
        document.body.addEventListener('keydown', keyDown);

        function keyDown(event) {
            if([37, 38, 39, 40, 32].indexOf(event.keyCode) > -1) {
                event.preventDefault();
            }

            if (!isRunning && event.keyCode === 32) { 
                if (!document.getElementById('start-screen').classList.contains('hidden')) startGame();
                else if (!document.getElementById('game-over-screen').classList.contains('hidden')) startGame();
                return;
            }

            if (isRunning) {
                 // æ‰€æœ‰çš„æŒ‰é”®æ“ä½œç°åœ¨éƒ½èµ° queueMove
                 if (event.keyCode == 38 || event.keyCode == 87) queueMove(0, -1); // Up
                 if (event.keyCode == 40 || event.keyCode == 83) queueMove(0, 1);  // Down
                 if (event.keyCode == 37 || event.keyCode == 65) queueMove(-1, 0); // Left
                 if (event.keyCode == 39 || event.keyCode == 68) queueMove(1, 0);  // Right
                 if (event.keyCode == 80) togglePause();
            }
        }

        // è™šæ‹ŸæŒ‰é’®æ§åˆ¶ - ä¹Ÿæ”¹ä¸ºä½¿ç”¨ queueMove
        document.getElementById('btn-up').addEventListener('click', () => { if(isRunning) queueMove(0, -1); });
        document.getElementById('btn-down').addEventListener('click', () => { if(isRunning) queueMove(0, 1); });
        document.getElementById('btn-left').addEventListener('click', () => { if(isRunning) queueMove(-1, 0); });
        document.getElementById('btn-right').addEventListener('click', () => { if(isRunning) queueMove(1, 0); });

        // è§¦æ‘¸æ»‘åŠ¨æ§åˆ¶
        let touchStartX = 0;
        let touchStartY = 0;
        
        canvas.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: false});

        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault(); 
        }, {passive: false});

        canvas.addEventListener('touchend', function(e) {
            if(!isRunning) return;
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;
            handleSwipe(touchStartX, touchStartY, touchEndX, touchEndY);
        }, {passive: false});

        function handleSwipe(startX, startY, endX, endY) {
            let xDiff = endX - startX;
            let yDiff = endY - startY;

            if (Math.abs(xDiff) > Math.abs(yDiff)) {
                if (Math.abs(xDiff) > 30) { 
                    if (xDiff > 0) queueMove(1, 0);
                    else queueMove(-1, 0);
                }
            } else {
                if (Math.abs(yDiff) > 30) {
                    if (yDiff > 0) queueMove(0, 1);
                    else queueMove(0, -1);
                }
            }
        }

        function togglePause() {
            if (!isRunning) return;
            isPaused = !isPaused;
            if (!isPaused) {
                drawGame();
            } else {
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.fillRect(0,0,canvas.width/dpr, canvas.height/dpr);
                ctx.fillStyle = "white";
                ctx.font = "30px Arial";
                ctx.textAlign = "center";
                ctx.fillText("æš‚åœç›˜ç‚¹ä¸­...", canvas.width/dpr/2, canvas.height/dpr/2);
            }
        }

        async function submitScore() {
            const userId = document.getElementById('user-id').value.trim();
            if (!userId) return;

            const submittingDiv = document.getElementById('submitting-score');
            submittingDiv.classList.remove('hidden');

            try {
                const response = await fetch('../api/submit-score', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, score, game: 'snake' })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Score submitted:', data);
                } else {
                    console.error('Submit failed:', response.status, response.statusText);
                }
            } catch (error) {
                console.error('Failed to submit score:', error);
            } finally {
                submittingDiv.classList.add('hidden');
            }
        }

        async function showLeaderboard() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('leaderboard-screen').classList.remove('hidden');
            
            const loadingDiv = document.getElementById('leaderboard-loading');
            const listDiv = document.getElementById('leaderboard-list');
            
            loadingDiv.classList.remove('hidden');
            listDiv.classList.add('hidden');
            listDiv.innerHTML = '';

            try {
                const response = await fetch('../api/leaderboard');
                const data = await response.json();

                if (data.leaderboard && data.leaderboard.length > 0) {
                    listDiv.innerHTML = data.leaderboard.map(entry => {
                        const medal = entry.rank === 1 ? 'ğŸ¥‡' : entry.rank === 2 ? 'ğŸ¥ˆ' : entry.rank === 3 ? 'ğŸ¥‰' : `#${entry.rank}`;
                        const date = new Date(entry.timestamp).toLocaleDateString('zh-CN');
                        return `
                            <div class="flex items-center justify-between p-3 border-b border-gray-700 last:border-0 ${entry.userId === document.getElementById('user-id').value ? 'bg-orange-900/30' : ''}">
                                <div class="flex items-center gap-3">
                                    <span class="text-xl w-8 text-center">${medal}</span>
                                    <div>
                                        <div class="font-bold text-white">${entry.userId}</div>
                                        <div class="text-xs text-gray-400">${date}</div>
                                    </div>
                                </div>
                                <div class="text-2xl font-bold text-orange-400">${entry.score}</div>
                            </div>
                        `;
                    }).join('');
                    listDiv.classList.remove('hidden');
                } else {
                    listDiv.innerHTML = '<div class="p-6 text-center text-gray-400">æš‚æ— æ’è¡Œæ¦œæ•°æ®</div>';
                    listDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Failed to load leaderboard:', error);
                listDiv.innerHTML = '<div class="p-6 text-center text-red-400">åŠ è½½æ’è¡Œæ¦œå¤±è´¥</div>';
                listDiv.classList.remove('hidden');
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        function hideLeaderboard() {
            document.getElementById('leaderboard-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }
    </script>
</body>
</html>