<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amazing å¤§å¯Œç¿ - çˆ†å•ä¹‹è·¯ (æ‰©å……ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #232F3E; /* Dark Blue Theme */
            color: #333;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* æ£‹ç›˜ç½‘æ ¼å¸ƒå±€ */
        .board-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 3px;
            width: 98%; 
            max-width: 800px; 
            aspect-ratio: 1/1;
            margin: 0 auto;
            padding: 4px;
            background: #131921;
            position: relative; 
        }

        /* æ ¼å­æ ·å¼ */
        .tile {
            background-color: #f3f3f3;
            border-radius: 3px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px; 
            text-align: center;
            position: relative;
            border: 1px solid transparent;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
            padding: 2px;
            overflow: hidden;
        }

        .tile-name {
            font-weight: bold;
            line-height: 1.1;
            margin-bottom: 2px;
            font-size: 13px; 
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .tile-price {
            font-size: 11px; 
            font-weight: bold;
            color: #555;
        }

        /* ç‰¹æ®Šæ ¼å­é¢œè‰² */
        .tile-start { background-color: #bbf7d0; border-color: #22c55e; } 
        .tile-jail { background-color: #fecaca; border-color: #ef4444; } 
        .tile-chance { background-color: #fef08a; border-color: #eab308; } 
        .tile-tax { background-color: #e5e7eb; border-color: #6b7280; } 
        .tile-prop { background-color: white; }
        .tile-event { background-color: #e9d5ff; border-color: #9333ea; } 

        /* ç©å®¶æ£‹å­ */
        .player-token {
            position: absolute;
            top: 0; 
            left: 0; 
            width: 32px; 
            height: 32px;
            background-color: #FF9900;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            pointer-events: none; 
        }

        /* æ ¸å¿ƒå¤§æŒ‰é’®æ ·å¼ (éª°å­/æŒ‡å—/é‡å¼€) */
        .big-btn {
            width: 64px; 
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px; 
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
        }
        .big-btn:active { transform: scale(0.95); }
        
        .dice-btn-style { background: white; color: #1f2937; font-size: 36px; }
        
        .glossary-btn-style { background: #374151; color: #9ca3af; border: 1px solid #4b5563; }
        .glossary-btn-style:hover { background: #4b5563; color: white; }

        .restart-btn-style { background: #374151; color: #f87171; border: 1px solid #4b5563; }
        .restart-btn-style:hover { background: #4b5563; color: #ef4444; }

        .dice-rolling { animation: shake 0.5s infinite; }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-10deg); }
            100% { transform: rotate(0deg); }
        }

        /* ä¸­é—´æ§åˆ¶åŒº */
        .center-area {
            grid-column: 2 / span 6; 
            grid-row: 2 / span 6;
            background: #232F3E;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            color: white;
            z-index: 10;
            gap: 8px; 
        }

        /* å·²è´­ä¹°çš„äº§å“æ ‡è®° */
        .owned-mark {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px; 
            height: 8px;
            border-radius: 50%;
            background-color: #FF9900;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }
        
        /* ç­‰çº§æ˜Ÿçº§ */
        .level-stars {
            color: #FF9900;
            font-size: 10px;
            margin-top: 1px;
            line-height: 1;
            height: 10px; 
        }

        /* æ¶ˆæ¯æ—¥å¿— */
        .log-box {
            width: 95%;
            height: 90px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            overflow-y: auto;
            font-size: 13px;
            padding: 8px;
            text-align: left;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .log-item { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 3px; }
        .log-good { color: #4ade80; }
        .log-bad { color: #f87171; }
        .log-info { color: #94a3b8; }

        /* å¼¹çª—é€šç”¨æ ·å¼ */
        .modal {
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(4px);
        }
        
        /* æ¨¡å¼é€‰æ‹©æŒ‰é’® */
        .mode-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-weight: bold;
            text-align: left;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }
        .mode-btn:hover { transform: scale(1.02); border-color: rgba(255,255,255,0.3); }
        .mode-btn::after {
            content: '';
            position: absolute;
            right: -10px;
            bottom: -10px;
            font-size: 40px;
            opacity: 0.1;
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
        }
        
        /* åˆ—è¡¨ */
        .intro-list li {
            margin-bottom: 10px; 
            display: flex;
            align-items: flex-start;
            gap: 10px;
            text-align: left;
            font-size: 14px; 
            color: #e5e7eb;
        }
        .intro-icon { min-width: 24px; text-align: center; color: #FF9900; font-size: 16px; }

        /* Toast æç¤ºæ¡ */
        .toast {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
        .toast.error { background-color: rgba(220, 38, 38, 0.95); border: 1px solid #fecaca; }
        
        /* HUD æ ·å¼ */
        .hud-box {
            background-color: #374151;
            border: 1px solid #4b5563;
            border-radius: 8px;
            padding: 4px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            overflow: hidden;
        }
        .hud-label {
            font-size: 10px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1px;
            white-space: nowrap;
        }
        .hud-value {
            font-family: 'Roboto', sans-serif;
            font-weight: 900;
            line-height: 1.1;
            font-size: 18px; 
        }
        @media (min-width: 400px) {
            .hud-value { font-size: 22px; }
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center p-2">

    <!-- æ¸¸æˆæ ‡é¢˜ -->
    <div class="text-white text-center mb-2">
        <h1 class="text-2xl font-bold italic flex items-center justify-center gap-2">
            <i class="fas fa-truck-fast text-orange-500"></i> Amazing Poly
        </h1>
        <p class="text-xs text-gray-400">å¤§å¯Œç¿ï¼šçˆ†å•ä¹‹è·¯ (æ‰©å……ç‰ˆ)</p>
    </div>

    <!-- æ£‹ç›˜å®¹å™¨ -->
    <div class="board-grid" id="board">
        <!-- æ ¼å­ç”± JS ç”Ÿæˆ -->
        
        <!-- ç©å®¶æ£‹å­ -->
        <div id="player" class="player-token hidden">
            <i class="fas fa-box text-base text-gray-800"></i>
        </div>

        <!-- ä¸­é—´æ§åˆ¶åŒº -->
        <div class="center-area">
            
            <!-- é¡¶éƒ¨æ•°æ®é¢æ¿ (4åˆ—å¸ƒå±€) -->
            <div class="w-full grid grid-cols-4 gap-1 px-1 h-16">
                <!-- ç°é‡‘ -->
                <div class="hud-box">
                    <div class="hud-label">ç°é‡‘æµ</div>
                    <div class="hud-value text-green-400" id="cash-display">$2k</div>
                </div>
                <!-- æ”¶ç›Š -->
                <div class="hud-box">
                    <div class="hud-label">å›æ¬¾æ—¥</div>
                    <div class="hud-value text-yellow-400" id="income-display">+$200</div>
                </div>
                <!-- èµ„äº§ -->
                <div class="hud-box">
                    <div class="hud-label" id="target-label">æ€»èµ„äº§</div>
                    <div class="hud-value text-white" id="target-main-display">$2k</div>
                </div>
                <!-- å›åˆ (æ”¹ä¸º å›æ¬¾å‘¨æœŸ) -->
                <div class="hud-box relative">
                    <div id="turn-progress" class="absolute bottom-0 left-0 h-1 bg-blue-500 transition-all duration-500" style="width: 0%"></div>
                    <div class="hud-label">å›æ¬¾å‘¨æœŸ</div>
                    <div class="hud-value text-blue-400" id="turn-display">0/15</div>
                </div>
            </div>

            <!-- æ“ä½œåŒºï¼šå¤§æŒ‰é’® -->
            <div class="flex items-center justify-center gap-4 my-2 w-full">
                
                <!-- æœ¯è¯­æ‰‹å†ŒæŒ‰é’® (å·¦ä¾§) -->
                <div class="flex flex-col items-center gap-1">
                    <div class="big-btn glossary-btn-style" onclick="showGlossary()">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <span class="text-[10px] text-gray-500 font-bold">æŒ‡å—</span>
                </div>

                <!-- éª°å­æŒ‰é’® (ä¸­é—´) -->
                <div class="flex flex-col items-center gap-1">
                    <div id="dice-btn" class="big-btn dice-btn-style" onclick="rollDice()">
                        <i class="fas fa-dice text-gray-800"></i>
                    </div>
                    <p class="text-[10px] text-gray-400 font-bold h-4" id="action-hint">æ·éª°å­</p>
                </div>

                <!-- é‡å¼€æŒ‰é’® (å³ä¾§) -->
                <div class="flex flex-col items-center gap-1">
                    <div class="big-btn restart-btn-style" onclick="resetGame()">
                        <i class="fas fa-redo"></i>
                    </div>
                    <span class="text-[10px] text-gray-500 font-bold">é‡å¼€</span>
                </div>

            </div>

            <!-- æ¶ˆæ¯æ—¥å¿— -->
            <div class="log-box" id="game-log">
                <div class="log-item log-info">æ¬¢è¿æ¥åˆ° Amazing å¤§å¯Œç¿ï¼</div>
                <div class="log-item log-info">è¯·é€‰æ‹©æ¸¸æˆæ¨¡å¼...</div>
            </div>
        </div>
    </div>

    <!-- ä»‹ç»/æ¨¡å¼é€‰æ‹©å¼¹çª— -->
    <div id="intro-modal" class="fixed inset-0 modal flex items-center justify-center z-[60]">
        <div class="bg-gray-800 border-2 border-gray-600 rounded-xl p-6 w-96 text-center shadow-2xl relative max-h-[90vh] overflow-y-auto">
            <div class="mb-2 text-orange-500 text-5xl">
                <i class="fas fa-map-marked-alt"></i>
            </div>
            <h2 class="text-2xl font-bold text-white mb-1">é€‰æ‹©ç»è¥æ¨¡å¼</h2>
            <p class="text-xs text-gray-400 mb-6 uppercase tracking-widest">ä½ çš„ç›®æ ‡æ˜¯æˆä¸ºäº¿çº§å¤§å–</p>
            
            <div class="space-y-3">
                <button onclick="startGame('easy')" class="mode-btn bg-gradient-to-r from-green-900 to-gray-800 text-green-100 hover:from-green-800">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-base"><i class="fas fa-seedling mr-2"></i>åˆ›ä¸šèµ·æ­¥ (ç®€å•)</span>
                        <span class="text-xl font-bold">$8,000</span>
                    </div>
                    <div class="text-xs opacity-60 font-normal">é™ 15 ä¸ªå›æ¬¾æ—¥ | åˆå§‹èµ„é‡‘ $2,000</div>
                </button>

                <button onclick="startGame('hard')" class="mode-btn bg-gradient-to-r from-orange-900 to-gray-800 text-orange-100 hover:from-orange-800">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-base"><i class="fas fa-fire mr-2"></i>ç±»ç›®å¤§å– (å›°éš¾)</span>
                        <span class="text-xl font-bold">$20,000</span>
                    </div>
                    <div class="text-xs opacity-60 font-normal">é™ 30 ä¸ªå›æ¬¾æ—¥ | åˆå§‹èµ„é‡‘ $2,000</div>
                </button>

                <button onclick="startGame('endless')" class="mode-btn bg-gradient-to-r from-blue-900 to-gray-800 text-blue-100 hover:from-blue-800">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-base"><i class="fas fa-infinity mr-2"></i>æ°¸ç»­ç»è¥ (æ— é™)</span>
                        <span class="text-xl font-bold">æ— ä¸Šé™</span>
                    </div>
                    <div class="text-xs opacity-60 font-normal">æ— æ—¶é—´é™åˆ¶ | ç›®æ ‡ï¼šç”Ÿå­˜ä¸‹å»</div>
                </button>
            </div>
        </div>
    </div>

    <!-- è¿è¥é¿å‘æŒ‡å—å¼¹çª— -->
    <div id="glossary-modal" class="fixed inset-0 modal flex items-center justify-center z-[70] hidden">
        <div class="bg-gray-800 border-2 border-gray-600 rounded-xl p-6 w-80 shadow-2xl relative">
            <button onclick="document.getElementById('glossary-modal').classList.add('hidden')" class="absolute top-2 right-3 text-gray-400 hover:text-white text-xl">&times;</button>
            
            <h3 class="text-xl font-bold text-white mb-4 border-b border-gray-600 pb-2"><i class="fas fa-book mr-2 text-orange-500"></i>è¿è¥é¿å‘æŒ‡å—</h3>
            
            <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                <div class="bg-gray-900/50 p-3 rounded border-l-4 border-yellow-500">
                    <h4 class="text-yellow-400 font-bold text-sm mb-1">ğŸ’¸ VAT ç¨é‡‘ (Value Added Tax)</h4>
                    <p class="text-xs text-gray-400">æ¬§æ´²ç«™çš„å¢å€¼ç¨ã€‚åˆè§„è¿è¥å¿…é¡»ç¼´çº³ï¼Œå¦åˆ™åº—é“ºä¼šè¢«å°ã€‚æ¸¸æˆä¸­è¿™æ˜¯ä¸€ä¸ªé«˜é¢æ‰£è´¹ç‚¹ã€‚</p>
                </div>
                
                <div class="bg-gray-900/50 p-3 rounded border-l-4 border-red-500">
                    <h4 class="text-red-400 font-bold text-sm mb-1">ğŸš« äºŒå®¡ / å°å· (Account Suspension)</h4>
                    <p class="text-xs text-gray-400">äºšé©¬é€Šå¯¹è´¦å·è¿›è¡Œçš„ä¸¥æ ¼å®¡æ ¸ï¼Œé€šå¸¸ç”±èµ„æ–™å…³è”ã€ä¾µæƒç­‰è§¦å‘ã€‚è§¦å‘åä½ çš„èµ„é‡‘å°†è¢«å†»ç»“ï¼Œå‡ å›åˆå†…æ— æ³•æ“ä½œã€‚</p>
                </div>

                <div class="bg-gray-900/50 p-3 rounded border-l-4 border-purple-500">
                    <h4 class="text-purple-400 font-bold text-sm mb-1">ğŸ­ å·¥å‚å»¶æœŸ (Factory Delay)</h4>
                    <p class="text-xs text-gray-400">ä¾›åº”é“¾æ‰é“¾å­ã€‚å¯èƒ½æ˜¯åŸææ–™æ¶¨ä»·æˆ–é™ç”µï¼Œå¯¼è‡´æ— æ³•æŒ‰æ—¶å‘è´§ã€‚æ¸¸æˆä¸­ä¼šè®©ä½ å€’é€€å‡ æ­¥ï¼Œå¯èƒ½å†æ¬¡è¸©é›·ã€‚</p>
                </div>

                <div class="bg-gray-900/50 p-3 rounded border-l-4 border-green-500">
                    <h4 class="text-green-400 font-bold text-sm mb-1">ğŸ’° å›æ¬¾æ—¥ (Payout Date)</h4>
                    <p class="text-xs text-gray-400">äºšé©¬é€Šæ¯14å¤©æ‰“æ¬¾ä¸€æ¬¡ã€‚åœ¨æ¸¸æˆä¸­ç»è¿‡èµ·ç‚¹å³è§†ä¸ºå›æ¬¾ï¼Œä½ ä¼šè·å¾—åº•è–ªåŠ ä¸Šæ‰€æœ‰äº§å“çš„è¿è¥åˆ©æ¶¦ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆå¼¹çª—ï¼šè´­ä¹°/äº‹ä»¶ -->
    <div id="modal" class="fixed inset-0 modal flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-80 text-center shadow-2xl relative border-t-4 border-orange-500">
            <div id="modal-icon" class="text-6xl mb-4 text-gray-700">ğŸ“¦</div>
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-2">Title</h3>
            <p id="modal-desc" class="text-base text-gray-600 mb-6 leading-relaxed px-2">Description</p>
            
            <div id="modal-actions" class="flex flex-col gap-3">
                <!-- æŒ‰é’®åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- Toast å®¹å™¨ -->
    <div id="toast-container"></div>

    <script>
        // --- æ¸¸æˆé…ç½® ---
        const GRID_SIZE = 8; 
        const TOTAL_TILES = 28; 
        
        // åœ°å›¾æ•°æ® (28æ ¼)
        const mapData = [
            // Top Row (0-7)
            { type: 'START', name: 'å›æ¬¾æ—¥', icon: 'fa-money-bill-wave' },
            { type: 'PROP', name: 'æ‰‹æœºå£³', cost: 200, income: 50, level: 0, owner: null, icon: 'fa-mobile-alt' },
            { type: 'PROP', name: 'æ•°æ®çº¿', cost: 300, income: 80, level: 0, owner: null, icon: 'fa-plug' },
            { type: 'CHANCE', name: 'è¿è¥äº‹ä»¶', icon: 'fa-question' },
            { type: 'PROP', name: 'è“ç‰™è€³æœº', cost: 500, income: 150, level: 0, owner: null, icon: 'fa-headphones' },
            { type: 'TAX', name: 'ä»“å‚¨è´¹', cost: 200, icon: 'fa-warehouse' },
            { type: 'PROP', name: 'ç‘œä¼½å«', cost: 600, income: 180, level: 0, owner: null, icon: 'fa-walking' },
            { type: 'JAIL', name: 'äºŒå®¡/å°å·', icon: 'fa-lock' }, 

            // Right Column (8-13)
            { type: 'PROP', name: 'çŒ«ç ‚ç›†', cost: 700, income: 210, level: 0, owner: null, icon: 'fa-cat' },
            { type: 'PROP', name: 'å–‚é£Ÿå™¨', cost: 800, income: 240, level: 0, owner: null, icon: 'fa-cookie-bite' },
            { type: 'CHANCE', name: 'è¿è¥äº‹ä»¶', icon: 'fa-question' },
            { type: 'PROP', name: 'ç­‹è†œæª', cost: 900, income: 270, level: 0, owner: null, icon: 'fa-hammer' },
            { type: 'BACK', name: 'å·¥å‚å»¶æœŸ', icon: 'fa-history' }, 
            { type: 'PROP', name: 'ç©ºæ°”ç‚¸é”…', cost: 1000, income: 300, level: 0, owner: null, icon: 'fa-utensils' },

            // Bottom Row (14-21)
            { type: 'FREE', name: 'Prime Day', icon: 'fa-gift' }, 
            { type: 'PROP', name: 'æ‰«åœ°æœº', cost: 1200, income: 360, level: 0, owner: null, icon: 'fa-robot' },
            { type: 'PROP', name: 'æŠ•å½±ä»ª', cost: 1400, income: 420, level: 0, owner: null, icon: 'fa-video' },
            { type: 'TAX', name: 'PPCè¶…æ”¯', cost: 500, icon: 'fa-chart-line' },
            { type: 'PROP', name: 'å‡é™æ¡Œ', cost: 1600, income: 480, level: 0, owner: null, icon: 'fa-arrows-alt-v' },
            { type: 'CHANCE', name: 'è¿è¥äº‹ä»¶', icon: 'fa-question' },
            { type: 'PROP', name: 'æ— äººæœº', cost: 1800, income: 540, level: 0, owner: null, icon: 'fa-plane' },
            { type: 'GO_TO_JAIL', name: 'è¢«æŠ•è¯‰', icon: 'fa-exclamation-triangle' }, 

            // Left Column (22-27)
            { type: 'PROP', name: 'ç”µç«æ¤…', cost: 2000, income: 600, level: 0, owner: null, icon: 'fa-chair' },
            { type: 'BONUS', name: 'å¤©ä½¿èèµ„', icon: 'fa-hand-holding-usd' }, 
            { type: 'PROP', name: 'æˆ·å¤–ç”µæº', cost: 2500, income: 750, level: 0, owner: null, icon: 'fa-battery-full' },
            { type: 'PROP', name: '3Dæ‰“å°æœº', cost: 3000, income: 900, level: 0, owner: null, icon: 'fa-cube' },
            { type: 'TAX', name: 'VATç¨é‡‘', cost: 800, icon: 'fa-file-invoice-dollar' }, 
            { type: 'PROP', name: 'æ™ºèƒ½æ‰‹è¡¨', cost: 3500, income: 1050, level: 0, owner: null, icon: 'fa-clock' }
        ];

        // ç©å®¶çŠ¶æ€
        let player = {
            pos: 0,
            cash: 2000,
            baseSalary: 200,
            suspended: 0,
            assets: 2000, // åˆå§‹èµ„äº§ = ç°é‡‘
            payoutCount: 0 // æ”¹ä¸ºè®°å½•å›æ¬¾æ—¥æ¬¡æ•°
        };

        // æ¸¸æˆæ¨¡å¼é…ç½®
        let gameConfig = {
            mode: 'endless', 
            maxPayouts: Infinity, // æ”¹ä¸ºé™åˆ¶å›æ¬¾æ—¥
            targetAssets: Infinity
        };

        let isAnimating = false;

        // --- åˆå§‹åŒ– ---
        window.onload = function() {
            renderBoard();
            
            setTimeout(() => {
                movePlayerToken(0); 
                document.getElementById('player').classList.remove('hidden');
            }, 100);
            
            window.addEventListener('resize', () => movePlayerToken(player.pos));
        };

        function showGlossary() {
            document.getElementById('glossary-modal').classList.remove('hidden');
        }

        function startGame(mode) {
            document.getElementById('intro-modal').classList.add('hidden');
            
            gameConfig.mode = mode;
            player.payoutCount = 0; // åˆå§‹ä¸º0

            if (mode === 'easy') {
                gameConfig.maxPayouts = 15; // æ”¹ä¸º15ä¸ªå›æ¬¾æ—¥
                gameConfig.targetAssets = 8000;
                addLog("ç›®æ ‡ï¼š15ä¸ªå›æ¬¾å‘¨æœŸå†…æ€»èµ„äº§è¾¾ $8,000", "info");
            } else if (mode === 'hard') {
                gameConfig.maxPayouts = 30; // æ”¹ä¸º30ä¸ªå›æ¬¾æ—¥
                gameConfig.targetAssets = 20000;
                addLog("ç›®æ ‡ï¼š30ä¸ªå›æ¬¾å‘¨æœŸå†…æ€»èµ„äº§è¾¾ $20,000", "info");
            } else {
                gameConfig.maxPayouts = Infinity;
                gameConfig.targetAssets = Infinity;
                addLog("ç›®æ ‡ï¼šå°½å¯èƒ½ç”Ÿå­˜ä¸‹å»ï¼", "info");
            }
            
            updateUI();
        }

        // --- æ¸²æŸ“æ£‹ç›˜ (8x8 é€»è¾‘) ---
        function renderBoard() {
            const board = document.getElementById('board');
            
            const playerToken = document.getElementById('player');
            const centerArea = document.querySelector('.center-area');
            
            board.innerHTML = '';
            
            for (let i = 0; i < TOTAL_TILES; i++) {
                const tileData = mapData[i];
                const el = document.createElement('div');
                
                let col, row;
                if (i <= 7) { row = 1; col = i + 1; } // Top
                else if (i <= 14) { col = 8; row = i - 7 + 1; } // Right
                else if (i <= 21) { row = 8; col = 8 - (i - 14); } // Bottom
                else { col = 1; row = 8 - (i - 21); } // Left

                el.style.gridColumn = col;
                el.style.gridRow = row;
                
                let typeClass = 'tile-prop';
                if (tileData.type === 'START') typeClass = 'tile-start';
                else if (tileData.type === 'JAIL' || tileData.type === 'GO_TO_JAIL') typeClass = 'tile-jail';
                else if (tileData.type === 'CHANCE') typeClass = 'tile-chance';
                else if (tileData.type === 'TAX') typeClass = 'tile-tax';
                else if (tileData.type === 'FREE') typeClass = 'tile-chance'; 
                else if (tileData.type === 'BACK') typeClass = 'tile-tax';
                else if (tileData.type === 'BONUS') typeClass = 'tile-event';

                el.className = `tile ${typeClass}`;
                el.id = `tile-${i}`;

                let content = `<i class="fas ${tileData.icon} mb-1 opacity-80 text-lg"></i>`;
                content += `<div class="tile-name">${tileData.name}</div>`;
                
                if (tileData.type === 'PROP') {
                    content += `<div class="tile-price">$${tileData.cost}</div>`;
                    content += `<div class="level-stars" id="stars-${i}"></div>`;
                }

                el.innerHTML = content;
                board.appendChild(el);
            }
            
            if (centerArea) board.appendChild(centerArea);
            if (playerToken) board.appendChild(playerToken); 
        }

        // --- æ ¸å¿ƒé€»è¾‘ ---

        function rollDice() {
            if (isAnimating || player.suspended > 0) {
                if (player.suspended > 0) {
                    addLog(`è´¦å·å®¡æ ¸ä¸­ï¼Œæš‚åœ ${player.suspended} å›åˆ...`, 'bad');
                    player.suspended--;
                    updateUI();
                }
                return;
            }

            isAnimating = true;
            const diceBox = document.getElementById('dice-btn');
            const hintEl = document.getElementById('action-hint');
            
            diceBox.classList.add('dice-rolling');
            hintEl.innerText = "Rolling...";
            
            let rolls = 0;
            const rollInterval = setInterval(() => {
                const tempVal = Math.floor(Math.random() * 6) + 1;
                diceBox.innerHTML = `<i class="fas fa-dice-${['one','two','three','four','five','six'][tempVal-1]}"></i>`;
                rolls++;
                if (rolls > 10) {
                    clearInterval(rollInterval);
                    diceBox.classList.remove('dice-rolling');
                    const steps = Math.floor(Math.random() * 6) + 1;
                    
                    diceBox.innerHTML = `<i class="fas fa-dice-${['one','two','three','four','five','six'][steps-1]}"></i>`;
                    
                    hintEl.innerText = `${steps} ç‚¹`;
                    hintEl.classList.remove('animate-pulse', 'text-gray-400');
                    hintEl.classList.add('text-yellow-400', 'font-bold', 'text-lg');
                    
                    movePlayerLogic(steps);
                }
            }, 50);
        }

        function movePlayerLogic(steps) {
            let currentStep = 0;
            
            const stepInterval = setInterval(() => {
                player.pos = (player.pos + 1) % TOTAL_TILES;
                movePlayerToken(player.pos);
                
                if (player.pos === 0) {
                    handlePassStart();
                }

                currentStep++;
                if (currentStep >= steps) {
                    clearInterval(stepInterval);
                    isAnimating = false;
                    handleTileArrival(player.pos);
                    
                    setTimeout(() => {
                        const hintEl = document.getElementById('action-hint');
                        if(document.getElementById('modal').classList.contains('hidden')) {
                            hintEl.innerText = "ç‚¹å‡»éª°å­";
                            hintEl.classList.add('animate-pulse', 'text-gray-400');
                            hintEl.classList.remove('text-yellow-400', 'font-bold', 'text-xs'); 
                        }
                    }, 1500);
                    
                    // Win Check (Anytime)
                    checkWinOrLose();
                }
            }, 300);
        }

        function movePlayerToken(index) {
            const tile = document.getElementById(`tile-${index}`);
            const token = document.getElementById('player');
            const board = document.getElementById('board');
            
            if (!tile || !board || !token) return;

            const tileRect = tile.getBoundingClientRect();
            const boardRect = board.getBoundingClientRect();
            
            const top = tileRect.top - boardRect.top + (tileRect.height/2 - 16);
            const left = tileRect.left - boardRect.left + (tileRect.width/2 - 16);

            token.style.transform = `translate(${left}px, ${top}px)`;
        }

        // --- äº‹ä»¶å¤„ç† ---

        function handlePassStart() {
            // Increment payouts
            player.payoutCount++;
            
            let totalIncome = player.baseSalary;
            mapData.forEach(t => {
                if (t.type === 'PROP' && t.owner === 'player') {
                    totalIncome += Math.floor(t.income * (1 + t.level * 0.5));
                }
            });
            player.cash += totalIncome;
            addLog(`å›æ¬¾æ—¥ï¼å…¥è´¦ +$${totalIncome}`, 'good');
            updateUI();
            showToast(`å›æ¬¾æ—¥åˆ°è´¦ +$${totalIncome}`);
            
            // Check Lose Condition (Payout limit reached)
            checkWinOrLose();
        }

        function checkWinOrLose() {
            if (gameConfig.mode === 'endless') return;

            // Check Win
            if (player.assets >= gameConfig.targetAssets) {
                showModal(
                    'æ­å–œä¸Šå¸‚ï¼ğŸ‰',
                    `åœ¨ç¬¬ ${player.payoutCount} ä¸ªå›æ¬¾å‘¨æœŸï¼Œä½ çš„æ€»èµ„äº§è¾¾åˆ°äº† <span class="text-green-500 font-bold">$${player.assets}</span>ï¼<br>ä½ å·²ç»æ˜¯ç±»ç›®ç‹è€…äº†ï¼`,
                    [{ text: 'è¿”å›ä¸»èœå•', class: 'bg-green-500 text-white', action: () => location.reload() }]
                );
                return;
            }

            // Check Lose (Only after passing start, logic inside handlePassStart incremented it)
            if (player.payoutCount >= gameConfig.maxPayouts && player.assets < gameConfig.targetAssets) {
                showModal(
                    'å¯¹èµŒå¤±è´¥ ğŸ˜­',
                    `æ—¶é—´åˆ°ï¼ç»è¿‡ ${gameConfig.maxPayouts} ä¸ªå›æ¬¾å‘¨æœŸï¼Œæ€»èµ„äº§ $${player.assets} æœªè¾¾æ ‡ã€‚<br>æŠ•èµ„äººæ’¤èµ„äº†ã€‚`,
                    [{ text: 'å†è¯•ä¸€æ¬¡', class: 'bg-orange-500 text-white', action: () => location.reload() }]
                );
            }
        }

        function handleTileArrival(index) {
            const tile = mapData[index];

            if (tile.type === 'PROP') {
                if (tile.owner === null) {
                    const canAfford = player.cash >= tile.cost;
                    const costClass = canAfford ? 'text-gray-600' : 'text-red-500 font-bold';
                    
                    showModal(
                        'å‘ç°è“æµ·æ–°å“', 
                        `äº§å“ï¼š${tile.name}<br>é¦–æ‰¹å¤‡è´§æˆæœ¬ï¼š<span class="${costClass}">$${tile.cost}</span><br>é¢„è®¡å•æ¬¡æ”¶ç›Šï¼š$${tile.income}`,
                        [
                            { text: 'ä¸Šæ¶é”€å”® (Buy)', class: 'bg-green-500 text-white hover:bg-green-600', action: () => buyProp(index) },
                            { text: 'æ”¾å¼ƒæœºä¼š', class: 'bg-gray-200 text-gray-700 hover:bg-gray-300', action: closeModal }
                        ]
                    );
                } else {
                    const upgradeCost = Math.floor(tile.cost * 0.5);
                    const canAfford = player.cash >= upgradeCost;
                    const costClass = canAfford ? 'text-gray-600' : 'text-red-500 font-bold';

                    showModal(
                        'ä¼˜åŒ–è¿è¥ (PPC)', 
                        `äº§å“ï¼š${tile.name}<br>å½“å‰ç­‰çº§ï¼šLv.${tile.level}<br>æŠ•å…¥å¹¿å‘Šè´¹ <span class="${costClass}">$${upgradeCost}</span> æå‡æ’åï¼Ÿ`,
                        [
                            { text: 'åŠ å¤§æŠ•æ”¾ (Upgrade)', class: 'bg-blue-500 text-white hover:bg-blue-600', action: () => upgradeProp(index) },
                            { text: 'ç»´æŒç°çŠ¶', class: 'bg-gray-200 text-gray-700 hover:bg-gray-300', action: closeModal }
                        ]
                    );
                }
            } else if (tile.type === 'TAX') {
                player.cash -= tile.cost;
                addLog(`æ”¯ä»˜${tile.name}: -$${tile.cost}`, 'bad');
                checkBankruptcy();
            } else if (tile.type === 'CHANCE') {
                triggerChance();
            } else if (tile.type === 'GO_TO_JAIL') {
                addLog('é­é‡æ¶æ„æŠ•è¯‰ï¼è´¦å·å®¡æ ¸ä¸­...', 'bad');
                player.pos = 7; 
                movePlayerToken(7);
                player.suspended = 2; 
            } else if (tile.type === 'JAIL') {
                addLog('è·¯è¿‡å®¡æ ¸éƒ¨ï¼Œè™šæƒŠä¸€åœºã€‚', 'info');
            } else if (tile.type === 'FREE') {
                const bonus = Math.floor(Math.random() * 500) + 300; 
                player.cash += bonus;
                addLog(`Prime Day çˆ†å•ï¼æµé‡å…è´¹ï¼Œå…¥è´¦ +$${bonus}`, 'good');
                showModal(
                    'Prime Day çˆ†å•',
                    `å¤§ä¿ƒæµé‡è¢­æ¥ï¼ä½ çš„äº§å“é”€é‡æš´æ¶¨ã€‚<br>è·å¾—é¢å¤–æ”¶ç›Š <span class="text-green-600 font-bold">$${bonus}</span>`,
                    [{ text: 'å¼€å¿ƒæ”¶é’±', class: 'bg-green-500 text-white hover:bg-green-600', action: closeModal }]
                );
            } else if (tile.type === 'BACK') {
                addLog('å·¥å‚å‘è´§å»¶æœŸï¼Œåé€€ 2 æ ¼', 'bad');
                setTimeout(() => {
                    let newPos = player.pos - 2;
                    if(newPos < 0) newPos += TOTAL_TILES;
                    player.pos = newPos;
                    movePlayerToken(newPos);
                    setTimeout(() => handleTileArrival(newPos), 500);
                }, 800);
            } else if (tile.type === 'BONUS') {
                const bonus = 1000;
                player.cash += bonus;
                addLog(`è·å¾—å¤©ä½¿èèµ„ï¼š+$${bonus}`, 'good');
                showModal(
                    'å¤©ä½¿è½®èèµ„',
                    `æŠ•èµ„äººçœ‹å¥½ä½ çš„é¡¹ç›®ï¼<br>è·å¾—èèµ„ <span class="text-green-600 font-bold">$${bonus}</span>`,
                    [{ text: 'æ”¶ä¸‹èµ„é‡‘', class: 'bg-yellow-500 text-white hover:bg-yellow-600', action: closeModal }]
                );
            }
            updateUI();
        }

        // --- æ ¸å¿ƒæ“ä½œ ---

        function buyProp(index) {
            const tile = mapData[index];
            if (player.cash >= tile.cost) {
                player.cash -= tile.cost;
                tile.owner = 'player';
                addLog(`æˆåŠŸä¸Šæ¶ï¼š${tile.name} (-$${tile.cost})`, 'good');
                
                const el = document.getElementById(`tile-${index}`);
                const mark = document.createElement('div');
                mark.className = 'owned-mark';
                el.appendChild(mark);
                el.style.borderColor = '#FF9900';
                
                closeModal();
                updateUI();
                checkWinOrLose();
            } else {
                showToast(`èµ„é‡‘ä¸è¶³ï¼ç¼º $${tile.cost - player.cash}`, "error");
            }
        }

        function upgradeProp(index) {
            const tile = mapData[index];
            const cost = Math.floor(tile.cost * 0.5);
            if (player.cash >= cost) {
                player.cash -= cost;
                tile.level++;
                addLog(`äº§å“ ${tile.name} å‡çº§åˆ° Lv.${tile.level} (-$${cost})`, 'good');
                
                const stars = document.getElementById(`stars-${index}`);
                stars.innerHTML = 'â˜…'.repeat(tile.level);
                
                closeModal();
                updateUI();
                checkWinOrLose();
            } else {
                showToast(`èµ„é‡‘ä¸è¶³ï¼ç¼º $${cost - player.cash}`, "error");
            }
        }

        function triggerChance() {
            const events = [
                { text: "listing è¢«æ¶æå˜ç‹—ï¼ŒæŸå¤± $200", val: -200 },
                { text: "è·å¾— Amazing Choice æ ‡ï¼Œå¥–åŠ± $300", val: 300 },
                { text: "ä»“åº“ä¸¢ä»¶èµ”å¿ï¼Œè·å¾— $150", val: 150 },
                { text: "é­é‡ 1 æ˜Ÿå·®è¯„ï¼Œé”€é‡ä¸‹æ»‘ï¼ŒæŸå¤± $100", val: -100 },
                { text: "ç«äº‰å¯¹æ‰‹æ–­è´§ï¼Œä½ çˆ†å•äº†ï¼å¥–åŠ± $500", val: 500 },
                { text: "æµ·è¿è´¹æš´æ¶¨ï¼Œé¢å¤–æ”¯ä»˜ $250", val: -250 }
            ];
            const evt = events[Math.floor(Math.random() * events.length)];
            
            showModal(
                'è¿è¥äº‹ä»¶',
                `<div class="text-3xl mb-3">${evt.val > 0 ? 'ğŸ˜†' : 'ğŸ˜­'}</div>${evt.text}`,
                [{ text: 'ç¡®å®š', class: 'bg-orange-500 text-white hover:bg-orange-600', action: () => {
                    player.cash += evt.val;
                    const sign = evt.val > 0 ? '+' : '';
                    addLog(evt.text + ` (${sign}$${evt.val})`, evt.val > 0 ? 'good' : 'bad');
                    checkBankruptcy();
                    closeModal();
                    updateUI();
                    checkWinOrLose();
                }}]
            );
        }

        // --- é‡ç½®åŠŸèƒ½ ---
        function resetGame() {
            if(!confirm("ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚")) return;

            // Reset Player
            player = {
                pos: 0,
                cash: 2000,
                baseSalary: 200,
                suspended: 0,
                assets: 2000,
                payoutCount: 0
            };

            // Reset Map Data
            mapData.forEach(tile => {
                if (tile.type === 'PROP') {
                    tile.owner = null;
                    tile.level = 0;
                }
            });

            // UI é‡ç½®
            movePlayerToken(0);
            document.getElementById('player').classList.add('hidden'); 

            renderBoard(); 
            
            document.getElementById('game-log').innerHTML = '<div class="log-item log-info">æ¬¢è¿æ¥åˆ° Amazing å¤§å¯Œç¿ï¼</div><div class="log-item log-info">è¯·é€‰æ‹©æ¸¸æˆæ¨¡å¼...</div>';

            document.getElementById('intro-modal').classList.remove('hidden');
            
            updateUI(); 
        }

        // --- UI & Helpers ---

        function updateUI() {
            // è®¡ç®—èµ„äº§
            let propertyValue = 0;
            let income = player.baseSalary;
            
            mapData.forEach(t => {
                if (t.owner === 'player') {
                    propertyValue += t.cost;
                    income += Math.floor(t.income * (1 + t.level * 0.5));
                }
            });
            player.assets = player.cash + propertyValue;

            // æ ¼å¼åŒ–æ•°å­—ï¼Œkä¸ºå•ä½
            const fmt = (n) => n >= 1000 ? (n/1000).toFixed(1) + 'k' : n;

            document.getElementById('cash-display').innerText = `$${fmt(player.cash)}`;
            document.getElementById('income-display').innerText = `+$${fmt(income)}`;
            document.getElementById('target-main-display').innerText = `$${fmt(player.assets)}`;

            // æ›´æ–°è¿›åº¦æ¡/ç›®æ ‡
            const targetLabel = document.getElementById('target-label');
            const turnProgress = document.getElementById('turn-progress');
            const turnDisplay = document.getElementById('turn-display');

            if (gameConfig.mode === 'endless') {
                targetLabel.innerText = "æ€»èµ„äº§ (æ— é™)";
                turnProgress.style.width = "100%";
                turnDisplay.innerText = `${player.payoutCount}`;
            } else {
                targetLabel.innerText = `ç›®æ ‡: $${fmt(gameConfig.targetAssets)}`;
                const pct = Math.min(100, (player.payoutCount / gameConfig.maxPayouts) * 100);
                turnProgress.style.width = `${pct}%`;
                turnDisplay.innerText = `${player.payoutCount}/${gameConfig.maxPayouts}`;
            }
        }

        function addLog(msg, type = 'info') {
            const box = document.getElementById('game-log');
            if(box) {
                const div = document.createElement('div');
                div.className = `log-item log-${type}`;
                div.innerText = msg;
                box.prepend(div); 
            }
        }

        function showModal(title, desc, actions) {
            const m = document.getElementById('modal');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-desc').innerHTML = desc;
            
            const actionBox = document.getElementById('modal-actions');
            actionBox.innerHTML = '';
            
            actions.forEach(act => {
                const btn = document.createElement('button');
                btn.className = `w-full py-2.5 px-4 rounded text-sm font-bold transition-colors ${act.class}`;
                btn.innerText = act.text;
                btn.onclick = () => {
                     act.action();
                     const hintEl = document.getElementById('action-hint');
                     if(hintEl) {
                        hintEl.innerText = "ç‚¹å‡»éª°å­";
                        hintEl.classList.add('animate-pulse', 'text-gray-400');
                        hintEl.classList.remove('text-yellow-400', 'font-bold', 'text-xs');
                     }
                };
                actionBox.appendChild(btn);
            });
            
            m.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            const hintEl = document.getElementById('action-hint');
            if(hintEl) {
                hintEl.innerText = "ç‚¹å‡»éª°å­";
                hintEl.classList.add('animate-pulse', 'text-gray-400');
                hintEl.classList.remove('text-yellow-400', 'font-bold', 'text-xs'); 
            }
        }

        function checkBankruptcy() {
            if (player.cash < 0) {
                showModal(
                    'èµ„é‡‘é“¾æ–­è£‚',
                    'å¾ˆé—æ†¾ï¼Œä½ çš„åº—é“ºå€’é—­äº†ã€‚<br>è¯·å¤§ä¾ é‡æ–°æ¥è¿‡ï¼',
                    [{ text: 'é‡æ–°å¼€åº—', class: 'bg-red-500 text-white', action: () => location.reload() }]
                );
            }
        }
        
        function showToast(msg, type='info') {
            let toast = document.getElementById('toast-msg');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'toast-msg';
                toast.className = 'toast';
                document.body.appendChild(toast);
            }
            
            toast.innerText = msg;
            toast.className = 'toast show'; 
            if (type === 'error') toast.classList.add('error');
            
            if(window.toastTimeout) clearTimeout(window.toastTimeout);
            
            window.toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => { toast.classList.remove('error'); }, 300); 
            }, 2500);
        }
    </script>
</body>
</html>