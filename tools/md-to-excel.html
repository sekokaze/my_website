<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 转 Excel (Cyberpunk Edition)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts for Tech look -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --accent: #06b6d4; /* Cyan-500 */
            --accent-glow: rgba(6, 182, 212, 0.5);
            --border-color: #334155;
        }

        body {
            font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            background-color: #0b1121;
            background-image: 
                linear-gradient(rgba(6, 182, 212, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            color: #e2e8f0;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border: 1px solid #0f172a;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }

        /* Tech Input Area */
        textarea {
            background-color: #0f172a !important;
            color: #a5f3fc !important; /* Cyan-200 */
            border: none;
            caret-color: #22d3ee;
        }
        textarea:focus {
            outline: none;
        }
        textarea::placeholder {
            color: #334155 !important;
        }

        /* Tech Table Styles (Preview) */
        .excel-preview table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            font-size: 13px;
            border: 1px solid #334155;
        }
        .excel-preview th, .excel-preview td {
            border: 1px solid #334155;
            padding: 10px 14px;
            white-space: pre-wrap;
            text-align: left;
        }
        .excel-preview th {
            background-color: rgba(6, 182, 212, 0.1);
            color: #22d3ee; /* Cyan-400 */
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid #06b6d4;
        }
        .excel-preview td {
            color: #cbd5e1; /* Slate-300 */
        }
        .excel-preview tr:nth-child(even) {
            background-color: rgba(30, 41, 59, 0.5);
        }
        .excel-preview tr:hover td {
            background-color: rgba(6, 182, 212, 0.15);
            color: #fff;
            box-shadow: inset 0 0 10px rgba(6, 182, 212, 0.1);
        }

        /* --- CRITICAL: Copy Mode Override --- 
           当复制时，强制变成黑字白底/透明底，
           这样粘贴到 Excel 才是正常的表格，而不是黑底白字。
        */
        .excel-preview.copy-mode table {
            border: 1px solid #000 !important;
            font-family: sans-serif !important; /* 恢复为常规字体 */
        }
        .excel-preview.copy-mode th {
            background-color: transparent !important;
            color: #000 !important;
            border: 1px solid #000 !important;
            border-bottom: 1px solid #000 !important;
        }
        .excel-preview.copy-mode td {
            background-color: transparent !important;
            color: #000 !important;
            border: 1px solid #000 !important;
        }
        .excel-preview.copy-mode tr {
            background-color: transparent !important;
        }

        /* Neon Button Effects */
        .btn-tech-primary {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid #06b6d4;
            color: #22d3ee;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.1);
            transition: all 0.2s ease;
        }
        .btn-tech-primary:hover {
            background: #06b6d4;
            color: #000;
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
            transform: translateY(-1px);
        }
        .btn-tech-primary:active {
            transform: translateY(0);
        }

        .btn-tech-secondary {
            background: transparent;
            border: 1px solid #475569;
            color: #94a3b8;
            transition: all 0.2s;
        }
        .btn-tech-secondary:hover {
            border-color: #94a3b8;
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .toast {
            animation: slideIn 0.3s ease-out forwards;
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-cyan-500 selection:text-white">

    <!-- Header -->
    <header class="border-b border-slate-800 bg-slate-900/80 backdrop-blur-md z-10 relative">
        <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="p-2 bg-cyan-500/10 rounded border border-cyan-500/20">
                    <i data-lucide="cpu" class="text-cyan-400 w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-cyan-50 tracking-wide">MARKDOWN <span class="text-cyan-400">//</span> EXCEL 转换器</h1>
                    <p class="text-[10px] text-cyan-600 font-mono tracking-widest uppercase">PROTOCOL v2.0 // 协议 v2.0</p>
                </div>
            </div>
            <div class="text-xs font-mono text-cyan-700 hidden sm:block flex items-center gap-2">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                SYSTEM ONLINE // 系统在线
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden relative">
        
        <!-- Input Section -->
        <div class="flex-1 flex flex-col border-r border-slate-800 bg-slate-900/50 min-h-[50%] lg:min-h-0 relative group">
            <div class="absolute inset-0 pointer-events-none border border-transparent group-hover:border-cyan-500/20 transition-colors duration-500 z-0"></div>
            
            <div class="p-3 border-b border-slate-800 flex justify-between items-center bg-slate-900/80 z-10">
                <label class="text-xs font-bold text-cyan-500 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="terminal" class="w-4 h-4"></i> INPUT STREAM // 输入流
                </label>
                <button onclick="clearInput()" class="text-[10px] text-rose-400 hover:text-rose-300 border border-rose-900/50 hover:bg-rose-900/20 px-2 py-1 rounded transition font-mono">
                    CLR // 清空
                </button>
            </div>
            <textarea 
                id="mdInput" 
                class="flex-1 w-full p-6 resize-none font-mono text-xs leading-relaxed z-10" 
                spellcheck="false"
                placeholder="// Paste Markdown Table Here...&#10;// 在此粘贴 Markdown 表格...&#10;&#10;| ID | MODEL | STATUS |&#10;| -- | ----- | ------ |&#10;| 01 | T-800 | ACTIVE |"
            ></textarea>
        </div>

        <!-- Output Section -->
        <div class="flex-1 flex flex-col bg-[#0b1121]/50 min-h-[50%] lg:min-h-0 relative">
            <div class="p-3 border-b border-slate-800 flex justify-between items-center bg-slate-900/80 shadow-lg z-10">
                <label class="text-xs font-bold text-cyan-500 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="table" class="w-4 h-4"></i> PREVIEW // 预览
                </label>
                <div class="flex space-x-2">
                    <button onclick="downloadCSV()" class="btn-tech-secondary flex items-center gap-2 px-3 py-1.5 text-xs font-bold rounded uppercase tracking-wide">
                        <i data-lucide="download" class="w-3 h-3"></i> CSV // 下载
                    </button>
                    <button onclick="copyToClipboard()" class="btn-tech-primary flex items-center gap-2 px-4 py-1.5 text-xs font-bold rounded uppercase tracking-wide">
                        <i data-lucide="copy" class="w-3 h-3"></i> COPY // 复制
                    </button>
                </div>
            </div>

            <!-- Preview Area -->
            <div class="flex-1 overflow-auto p-6 relative" id="previewContainer">
                <!-- Background decoration -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-cyan-500/5 rounded-full blur-3xl pointer-events-none"></div>

                <div id="emptyState" class="h-full flex flex-col items-center justify-center text-slate-600">
                    <div class="relative">
                        <div class="absolute inset-0 bg-cyan-500 blur-xl opacity-20"></div>
                        <i data-lucide="activity" class="w-16 h-16 mb-4 text-slate-700 relative z-10"></i>
                    </div>
                    <p class="font-mono text-xs tracking-widest uppercase">WAITING FOR DATA... // 等待数据...</p>
                </div>
                <div id="tableOutput" class="excel-preview hidden relative z-10"></div>
            </div>
        </div>
    </main>

    <!-- Tech Toast -->
    <div id="toast" class="fixed bottom-6 right-6 bg-slate-900 border border-cyan-500/50 text-cyan-400 px-5 py-3 rounded shadow-[0_0_20px_rgba(6,182,212,0.3)] transform translate-y-32 opacity-0 transition-all duration-300 flex items-center gap-3 z-50 font-mono text-sm">
        <div class="w-2 h-2 bg-cyan-400 rounded-full shadow-[0_0_10px_#22d3ee]"></div>
        <span id="toastMsg">OPERATION COMPLETE</span>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        const mdInput = document.getElementById('mdInput');
        const tableOutput = document.getElementById('tableOutput');
        const emptyState = document.getElementById('emptyState');

        // Main Parser Function
        function parseMarkdownTable(markdown) {
            const lines = markdown.trim().split('\n');
            const tableRows = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                if (line.indexOf('|') === -1) continue;

                // Check separator
                const isSeparator = line.replace(/[|:\-\s]/g, '') === '';
                if (isSeparator) continue;

                let cells = line.split('|');
                if (line.startsWith('|')) cells.shift();
                if (line.endsWith('|')) cells.pop();
                
                cells = cells.map(cell => cell.trim());
                tableRows.push(cells);
            }
            return tableRows;
        }

        // Render Function
        function renderTable() {
            const markdown = mdInput.value;
            const data = parseMarkdownTable(markdown);

            if (data.length === 0) {
                tableOutput.innerHTML = '';
                tableOutput.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            tableOutput.classList.remove('hidden');

            let html = '<table id="resultTable">';
            
            if (data.length > 0) {
                html += '<thead><tr>';
                data[0].forEach(cell => {
                    html += `<th>${escapeHtml(cell)}</th>`;
                });
                html += '</tr></thead>';
            }

            if (data.length > 1) {
                html += '<tbody>';
                for (let i = 1; i < data.length; i++) {
                    html += '<tr>';
                    data[i].forEach(cell => {
                        html += `<td>${escapeHtml(cell)}</td>`;
                    });
                    html += '</tr>';
                }
                html += '</tbody>';
            }

            html += '</table>';
            tableOutput.innerHTML = html;
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        mdInput.addEventListener('input', renderTable);
        renderTable();

        function clearInput() {
            mdInput.value = '';
            renderTable();
            mdInput.focus();
        }

        // --- Copy Functionality (Optimized for Excel) ---
        function copyToClipboard() {
            const data = parseMarkdownTable(mdInput.value);
            if (data.length === 0) {
                showToast('NO DATA / 无数据', 'error');
                return;
            }

            const tableOutput = document.getElementById('tableOutput');
            const tableElement = document.getElementById('resultTable');
            
            if (!tableElement) return;

            // 1. Enter "Copy Mode" (Forces black text / transparent bg)
            tableOutput.classList.add('copy-mode');

            const selection = window.getSelection();
            const range = document.createRange();
            
            range.selectNodeContents(tableElement);
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                document.execCommand('copy');
                showToast('COPIED / 已复制');
            } catch (err) {
                console.error('Copy failed', err);
                showToast('FAILED / 复制失败', 'error');
            }
            
            selection.removeAllRanges();
            
            // 2. Exit "Copy Mode" (Restore tech look)
            tableOutput.classList.remove('copy-mode');
        }

        // --- CSV Download ---
        function downloadCSV() {
            const data = parseMarkdownTable(mdInput.value);
            if (data.length === 0) {
                showToast('EMPTY / 内容为空', 'error');
                return;
            }

            let csvContent = "\uFEFF"; 
            
            data.forEach(row => {
                let rowContent = row.map(e => {
                    let cell = e.replace(/"/g, '""');
                    if (cell.search(/("|,|\n)/g) >= 0) {
                        cell = `"${cell}"`;
                    }
                    return cell;
                }).join(",");
                csvContent += rowContent + "\r\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "tech_export.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('DOWNLOADING / 下载中...');
        }

        // --- Tech Toast UI ---
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMsg');
            const indicator = toast.querySelector('div'); // The little dot

            if (type === 'error') {
                toast.classList.replace('border-cyan-500/50', 'border-rose-500/50');
                toast.classList.replace('text-cyan-400', 'text-rose-400');
                indicator.classList.replace('bg-cyan-400', 'bg-rose-400');
                indicator.classList.replace('shadow-[0_0_10px_#22d3ee]', 'shadow-[0_0_10px_#fb7185]');
            } else {
                toast.className = "fixed bottom-6 right-6 bg-slate-900 border border-cyan-500/50 text-cyan-400 px-5 py-3 rounded shadow-[0_0_20px_rgba(6,182,212,0.3)] transform transition-all duration-300 flex items-center gap-3 z-50 font-mono text-sm";
                indicator.className = "w-2 h-2 bg-cyan-400 rounded-full shadow-[0_0_10px_#22d3ee]";
            }
            
            toastMsg.textContent = message;
            toast.classList.remove('translate-y-32', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-32', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>